---
name: qa-sentinel:setup
description: Initialize Sentinel QA testing in the current project
argument-hint: "[optional: base URL of the application]"
---

# Initialize Sentinel QA Testing

Set up spec-driven QA testing in the current project using @qa-sentinel.

## User Input

```text
$ARGUMENTS
```

## Input Interpretation

| Input Pattern | Interpretation |
|---------------|----------------|
| Empty | Prompt for base URL during config generation |
| `http://localhost:3000` | Use as the application base URL |
| `https://staging.example.com` | Use as the application base URL |

## Phase 1: Check Prerequisites

### Verify Node.js

```bash
node --version
```

If Node.js is not installed, stop and tell the user: "Node.js is required for Sentinel. Install it from https://nodejs.org and try again."

### Verify Playwright Availability

```bash
npx playwright --version 2>/dev/null || echo "playwright-not-found"
```

If Playwright is not available, note that it may need to be installed later. This is not a blocker for setup — Sentinel uses Chrome DevTools MCP for browser control, not Playwright directly. Playwright is only needed if the project wants to use it for supplementary scripted tests.

## Phase 2: Scaffold Directory Structure

Run the Sentinel CLI `init` command to create the directory structure:

```bash
npx tsx ~/Source/OMG/agent-tools/skills/qa/tools/sentinel/src/cli.ts init
```

If the CLI is not yet built or fails, manually create the required directories:

```bash
mkdir -p tests/qa-sentinel/specs
mkdir -p tests/qa-sentinel/runs
mkdir -p tests/qa-sentinel/reports
```

## Phase 3: Generate Configuration

Use `AskUserQuestion` to gather configuration values interactively. If `$ARGUMENTS` contains a URL, use it as the default for the base URL question.

### 3a. Application Details

Ask the user:

1. **Base URL** — "What is the base URL of your running application?" (default: value from `$ARGUMENTS` or `http://localhost:3000`)
2. **Application name** — "What is the human-readable name for this application?" (default: derive from the project directory name)

### 3b. Authentication Strategy

Ask the user:

"How does authentication work in your application?"
- **credentials** — Login form with username/password
- **token** — Bearer token set via header or cookie
- **cookie** — Pre-set session cookie
- **none** — No authentication required

### 3c. Credentials Details (if strategy is `credentials`)

If the user chose `credentials`, ask:

1. **Login URL** — "What is the login page path?" (default: `/login`)
2. **Username** — "What username/email should be used for QA testing?" (e.g., `qa-tester@example.com`)
3. **Password env var** — "What environment variable holds the QA password?" (default: `SENTINEL_QA_PASSWORD`). Remind the user: "Never put actual passwords in config files. Set this env var in your shell before running tests."

### 3d. Browser Preferences

Ask the user:

1. **Headless mode** — "Run the browser in headless mode?" (default: `true`)
2. **Viewport size** — "What viewport size?" (default: `1280x720`)

### 3e. Evidence Capture

Ask the user:

"When should Sentinel capture screenshots and DOM snapshots?"
- **on_failure** — Only when a scenario fails (recommended, saves storage)
- **always** — Every scenario (good for baseline runs)
- **never** — Skip evidence capture (fastest)

Default: `on_failure`

### 3f. Write the Config File

Write `tests/qa-sentinel/sentinel.config.yaml` using the gathered values:

```yaml
# Sentinel Configuration
# Generated by qa-sentinel:setup

app:
  base_url: {base_url}
  name: {app_name}

auth:
  strategy: {strategy}
  # Include login_url and credentials block only if strategy is "credentials"
  # Include token/cookie guidance comments for other strategies

browser:
  headless: {headless}
  viewport:
    width: {width}
    height: {height}
  timeout: 30000

evidence:
  screenshots: {evidence_mode}
  traces: on_failure
  dom_snapshots: {evidence_mode}

paths:
  specs_dir: ./specs
  runs_dir: ./runs
  reports_dir: ./reports
```

For the `auth` section, adapt based on the chosen strategy:

**credentials:**
```yaml
auth:
  strategy: credentials
  login_url: {login_url}
  credentials:
    username: {username}
    password_env: {password_env}
```

**token:**
```yaml
auth:
  strategy: token
  # Set the SENTINEL_AUTH_TOKEN env var before running tests
  # Sentinel will include this as a Bearer token in browser requests
```

**cookie:**
```yaml
auth:
  strategy: cookie
  # Set the SENTINEL_SESSION_COOKIE env var before running tests
  # Sentinel will set this cookie in the browser before navigating
```

**none:**
```yaml
auth:
  strategy: none
```

## Phase 4: Write .gitignore

Write `tests/qa-sentinel/.gitignore`:

```
# Sentinel QA
# Exclude run evidence (screenshots, traces) — they are large and session-specific
runs/*/evidence/

# Keep run results (small markdown files) for regression tracking
# Keep specs (they ARE the tests)
# Keep reports for historical reference
```

## Phase 5: Update Project CLAUDE.md

Read the project's `CLAUDE.md` file (in the project root). If it exists, append a Sentinel section. If it does not exist, create it with the Sentinel section.

Append the following section (do not duplicate if it already exists):

```markdown
## QA Testing (Sentinel)

This project uses Sentinel for spec-driven QA testing. Specs are structured markdown files that Claude executes via browser automation.

- **Specs**: `tests/qa-sentinel/specs/` — each `.spec.md` file defines scenarios for a feature
- **Config**: `tests/qa-sentinel/sentinel.config.yaml`
- **Results**: `tests/qa-sentinel/runs/` — timestamped run results with evidence

### Commands

- `/qa-sentinel:setup` — Initialize Sentinel (already done)
- `/qa-sentinel:discover` — Scan specs and show coverage status
- `/qa-sentinel:run` — Execute specs against the running app
- `/qa-sentinel:report` — Generate coverage and regression reports
```

## Phase 6: Completion

Display a summary:

```markdown
## Sentinel Setup Complete

**Config**: tests/qa-sentinel/sentinel.config.yaml
**Specs directory**: tests/qa-sentinel/specs/
**Base URL**: {base_url}
**Auth**: {strategy}

### Directory Structure

tests/qa-sentinel/
  sentinel.config.yaml
  .gitignore
  specs/          <- write your spec files here
  runs/           <- test results will appear here
  reports/        <- generated reports

### What's Next?

1. **Discover existing features** — Run `/qa-sentinel:discover` to scan your app and generate spec files
2. **Write specs manually** — Create `.spec.md` files in `tests/qa-sentinel/specs/` following the spec format
3. **Run tests** — Use `/qa-sentinel:run` to execute specs against your running app
```

Ask the user: "Would you like to run `/qa-sentinel:discover` now to scan your application and generate initial specs?"
